const sheetId = "1Ona1thP9bqtVGF4k7F8VGR5RGUKD9L01p-o68k5ziEk";
const apiKey = "AIzaSyDFy7OEmx1dj4z2RzPhGA3_b4TNPgcIzEY";
const sheetName = "Sheet1"; // üîÅ CHANGE THIS IF YOUR SHEET TAB HAS A DIFFERENT NAME

const params = new URLSearchParams(window.location.search);
const userId = params.get("id");

if (!userId) {
  document.getElementById("card").innerHTML = "<p>User ID not provided in URL.</p>";
} else {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}?key=${apiKey}`;

  fetch(url)
    .then(res => {
      if (!res.ok) throw new Error(`HTTP ${res.status} - ${res.statusText}`);
      return res.json();
    })
    .then(data => {
      if (!data.values || data.values.length < 2) {
        throw new Error("Sheet returned no usable data");
      }

      const rows = data.values;
      const headers = rows[0];
      const userIndex = headers.indexOf("USER_ID");

      const student = rows.find(row => row[userIndex] === userId);

      if (!student) {
        document.getElementById("card").innerHTML = "<p>Student not found.</p>";
        return;
      }

      const get = (field) => student[headers.indexOf(field)] || "";

      document.getElementById("name").textContent = get("NAME");
      document.getElementById("fname").textContent = get("FNAME");
      document.getElementById("mname").textContent = get("MNAME");
      document.getElementById("dob").textContent = get("DOB");
      document.getElementById("class").textContent = get("CLASS");
      document.getElementById("subjects").textContent = get("SUBJECTS");
      document.getElementById("admno").textContent = get("ADMNO");
      document.getElementById("admdt").textContent = get("ADMDATE");
      document.getElementById("mobile").textContent = get("MOBILE");
      document.getElementById("address").textContent = get("ADDRESS");
      document.getElementById("district").textContent = get("DISTRICT");
      document.getElementById("status").textContent = get("STATUS");

      const photo = get("ADMNO");
      document.getElementById("photo").src = `https://raw.githubusercontent.com/rdcollege/idcard/main/photos/${photo}.jpg`;
    })
    .catch(error => {
      console.error("Error fetching data:", error);
      document.getElementById("card").innerHTML = `<p>Error fetching data: ${error.message}</p>`;
    });
}
